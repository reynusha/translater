<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum | TON NFT Marketplace</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #111111;
            --bg-card: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #888888;
            --accent: #0088cc;
            --ton: #0088cc;
            --success: #00c781;
            --border: #2a2a2a;
            --gradient: linear-gradient(135deg, #0088cc, #00c6ff);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Segoe UI Emoji', sans-serif;
        }
        
        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            padding-bottom: 80px;
        }
        
        .container {
            max-width: 428px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .header {
            padding: 24px 0;
            text-align: center;
            border-bottom: 1px solid var(--border);
            margin-bottom: 24px;
        }
        
        .logo {
            font-size: 28px;
            font-weight: 700;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }
        
        .subtitle {
            color: var(--text-secondary);
            font-size: 14px;
            margin-top: 4px;
            font-weight: 400;
        }
        
        .section {
            margin-bottom: 32px;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .section-title i {
            color: var(--accent);
        }
        
        .wallet-card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 24px;
            border: 1px solid var(--border);
        }
        
        .wallet-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        
        .wallet-address {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            color: var(--text-secondary);
            background: var(--bg-secondary);
            padding: 8px 12px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }
        
        .connect-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
        }
        
        .connect-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 136, 204, 0.3);
        }
        
        .connect-btn.connected {
            background: var(--success);
        }
        
        .grid {
            display: grid;
            gap: 16px;
        }
        
        .grid-2 {
            grid-template-columns: 1fr 1fr;
        }
        
        .nft-card {
            background: var(--bg-card);
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .nft-card:hover {
            transform: translateY(-4px);
            border-color: var(--accent);
            box-shadow: 0 8px 24px rgba(0, 136, 204, 0.15);
        }
        
        .nft-image {
            width: 100%;
            height: 160px;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .nft-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .nft-content {
            padding: 16px;
        }
        
        .nft-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .nft-price {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
            color: var(--ton);
            margin-bottom: 8px;
        }
        
        .nft-stock {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .buy-btn {
            width: 100%;
            background: var(--gradient);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 8px;
        }
        
        .buy-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 136, 204, 0.3);
        }
        
        .buy-btn:disabled {
            background: var(--border);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .profile-card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid var(--border);
            text-align: center;
        }
        
        .avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--gradient);
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
        }
        
        .username {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .member-since {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }
        
        .collection-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }
        
        .collection-item {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 16px;
            text-align: center;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .collection-item:hover {
            transform: scale(1.05);
            border-color: var(--accent);
        }
        
        .collection-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 8px;
            border-radius: 12px;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .collection-name {
            font-size: 12px;
            font-weight: 500;
        }
        
        .empty-state {
            text-align: center;
            padding: 48px 20px;
            color: var(--text-secondary);
        }
        
        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
            display: flex;
            padding: 12px 20px;
            backdrop-filter: blur(20px);
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.2s ease;
        }
        
        .nav-item.active {
            background: rgba(0, 136, 204, 0.1);
            color: var(--accent);
        }
        
        .nav-icon {
            font-size: 20px;
        }
        
        .nav-label {
            font-size: 11px;
            font-weight: 500;
        }
        
        .page {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--bg-card);
            border-radius: 24px;
            padding: 24px;
            margin: 20px;
            max-width: 380px;
            width: 100%;
            border: 1px solid var(--border);
            animation: modalSlide 0.3s ease;
        }
        
        @keyframes modalSlide {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .modal-header {
            display: flex;
            align-items: center;
            justify-content: between;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 20px;
            cursor: pointer;
            padding: 4px;
        }
        
        .modal-image {
            width: 100%;
            height: 200px;
            background: var(--bg-secondary);
            border-radius: 16px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .modal-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .info-label {
            color: var(--text-secondary);
        }
        
        .info-value {
            font-weight: 500;
        }
        
        .upgrade-notice {
            background: rgba(0, 136, 204, 0.1);
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
            border-left: 3px solid var(--accent);
        }
        
        .upgrade-title {
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .upgrade-text {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.4;
        }
        
        .purchase-time {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 12px;
            margin-top: 16px;
            font-size: 13px;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">QUANTUM</div>
            <div class="subtitle">Premium Digital Collectibles</div>
        </div>
        
        <!-- Store Page -->
        <div id="store-page" class="page active">
            <div class="wallet-card">
                <div class="wallet-info">
                    <div class="wallet-address" id="wallet-address">Not connected</div>
                    <button class="connect-btn" id="connect-btn">
                        <i class="fas fa-wallet"></i>
                        <span id="connect-text">Connect Wallet</span>
                    </button>
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title">
                    <i class="fas fa-gem"></i>
                    Exclusive Collection
                </h2>
                
                <div class="grid grid-2">
                    <!-- Christian Cross -->
                    <div class="nft-card" onclick="showNFTModal('cross')">
                        <div class="nft-image">
                            <i class="fas fa-cross" style="font-size: 48px; color: #fff;"></i>
                        </div>
                        <div class="nft-content">
                            <div class="nft-name">Christian Cross</div>
                            <div class="nft-price">
                                <i class="fab fa-toncoin"></i>
                                <span>0.5 TON</span>
                            </div>
                            <div class="nft-stock" id="cross-stock">1,200 available</div>
                            <button class="buy-btn" onclick="event.stopPropagation(); buyNFT('cross')">
                                Purchase
                            </button>
                        </div>
                    </div>
                    
                    <!-- Cybercar -->
                    <div class="nft-card" onclick="showNFTModal('cybercar')">
                        <div class="nft-image">
                            <img src="https://t.me/qentrum/6" alt="Cybercar" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                            <i class="fas fa-car" style="font-size: 48px; color: #00c6ff; display: none;"></i>
                        </div>
                        <div class="nft-content">
                            <div class="nft-name">Cybercar</div>
                            <div class="nft-price">
                                <i class="fab fa-toncoin"></i>
                                <span>0.5 TON</span>
                            </div>
                            <div class="nft-stock" id="cybercar-stock">2,000 available</div>
                            <button class="buy-btn" onclick="event.stopPropagation(); buyNFT('cybercar')">
                                Purchase
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Profile Page -->
        <div id="profile-page" class="page">
            <div class="profile-card">
                <div class="avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="username" id="user-name">User</div>
                <div class="member-since" id="user-joined">Member since: Loading...</div>
            </div>
            
            <div class="section">
                <h2 class="section-title">
                    <i class="fas fa-crown"></i>
                    My Collection
                </h2>
                
                <div id="collection-container">
                    <div class="empty-state" id="empty-collection">
                        <i class="fas fa-box-open"></i>
                        <p>Your collection is empty</p>
                        <p style="font-size: 13px; margin-top: 8px;">Start building your digital assets</p>
                    </div>
                    <div class="collection-grid" id="collection-grid" style="display: none;">
                        <!-- Collection items will appear here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="showPage('store-page')">
            <div class="nav-icon">
                <i class="fas fa-store"></i>
            </div>
            <div class="nav-label">Market</div>
        </div>
        <div class="nav-item" onclick="showPage('profile-page')">
            <div class="nav-icon">
                <i class="fas fa-user"></i>
            </div>
            <div class="nav-label">Profile</div>
        </div>
    </div>
    
    <!-- NFT Modal -->
    <div class="modal" id="nft-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modal-title">NFT Details</div>
                <button class="close-btn" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-image" id="modal-image">
                <!-- Image will be inserted here -->
            </div>
            
            <div class="info-row">
                <div class="info-label">Name:</div>
                <div class="info-value" id="modal-name">-</div>
            </div>
            
            <div class="info-row">
                <div class="info-label">Price:</div>
                <div class="info-value" id="modal-price">-</div>
            </div>
            
            <div class="info-row">
                <div class="info-label">Supply:</div>
                <div class="info-value" id="modal-supply">-</div>
            </div>
            
            <div class="info-row">
                <div class="info-label">Upgrade Status:</div>
                <div class="info-value" id="modal-upgrade">Not available</div>
            </div>
            
            <div id="purchase-time-container" style="display: none;">
                <div class="purchase-time">
                    <i class="fas fa-clock"></i>
                    Purchased: <span id="purchase-time">-</span>
                </div>
            </div>
            
            <div class="upgrade-notice">
                <div class="upgrade-title">
                    <i class="fas fa-rocket"></i>
                    Evolution Roadmap
                </div>
                <div class="upgrade-text">
                    Enhancement upgrades are scheduled for release in the near future. These digital collectibles will be convertible into exclusive NFTs with unique traits and rarity scores. The community and holders will govern pricing dynamics on our upcoming marketplace platform.
                </div>
            </div>
            
            <button class="buy-btn" id="modal-buy-btn" style="margin-top: 20px; display: none;">
                Purchase for 0.5 TON
            </button>
        </div>
    </div>

    <script>
        // Telegram WebApp
        const tg = window.Telegram.WebApp;
        
        // Initialize
        tg.expand();
        tg.enableClosingConfirmation();
        
        // TON Connect
        let tonConnectUI;
        let isConnected = false;
        
        // User data
        let userData = {
            id: tg.initDataUnsafe.user?.id || 'unknown',
            firstName: tg.initDataUnsafe.user?.first_name || 'User',
            lastName: tg.initDataUnsafe.user?.last_name || '',
            username: tg.initDataUnsafe.user?.username || '',
            joinDate: null
        };
        
        // NFTs data
        let nftsData = {
            cross: {
                name: 'Christian Cross',
                price: '0.5 TON',
                totalSupply: 1200,
                currentSupply: 1200,
                icon: 'cross',
                image: null,
                description: 'Exclusive spiritual digital collectible'
            },
            cybercar: {
                name: 'Cybercar',
                price: '0.5 TON',
                totalSupply: 2000,
                currentSupply: 2000,
                icon: 'car',
                image: 'https://t.me/qentrum/6',
                description: 'Futuristic vehicle digital asset'
            }
        };
        
        // User's collection
        let userCollection = [];
        let currentModalNFT = null;
        let isViewingOwnedNFT = false;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // Load user data
            loadUserData();
            
            // Load user collection
            loadUserCollection();
            
            // Initialize TON Connect
            initTONConnect();
            
            // Update display
            updateDisplay();
        }
        
        // Initialize TON Connect
        function initTONConnect() {
            // In a real app, you would initialize TON Connect UI here
            // tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            //     manifestUrl: 'https://your-domain.com/tonconnect-manifest.json'
            // });
            
            // For demo purposes, we'll simulate wallet connection
            setTimeout(() => {
                // Simulate wallet connection
                document.getElementById('connect-btn').addEventListener('click', toggleWalletConnection);
            }, 1000);
        }
        
        // Toggle wallet connection
        function toggleWalletConnection() {
            if (!isConnected) {
                // Connect wallet
                isConnected = true;
                document.getElementById('connect-text').textContent = 'Connected';
                document.getElementById('connect-btn').classList.add('connected');
                document.getElementById('wallet-address').textContent = 'UQBYt...lYEF';
                
                tg.showPopup({
                    title: 'Wallet Connected',
                    message: 'TON wallet successfully connected. You can now purchase digital collectibles.',
                    buttons: [{id: 'ok', type: 'default', text: 'OK'}]
                });
            } else {
                // Disconnect wallet
                isConnected = false;
                document.getElementById('connect-text').textContent = 'Connect Wallet';
                document.getElementById('connect-btn').classList.remove('connected');
                document.getElementById('wallet-address').textContent = 'Not connected';
            }
        }
        
        // Load user data
        function loadUserData() {
            // Set user name
            const nameElement = document.getElementById('user-name');
            nameElement.textContent = userData.firstName + (userData.lastName ? ' ' + userData.lastName : '');
            
            // Set join date
            const joinElement = document.getElementById('user-joined');
            const joinDate = localStorage.getItem('quantum_join_date');
            if (joinDate) {
                userData.joinDate = new Date(joinDate);
                joinElement.textContent = 'Member since: ' + formatDate(userData.joinDate);
            } else {
                const now = new Date();
                localStorage.setItem('quantum_join_date', now.toISOString());
                userData.joinDate = now;
                joinElement.textContent = 'Member since: ' + formatDate(now);
            }
        }
        
        // Load user collection
        function loadUserCollection() {
            const savedCollection = localStorage.getItem('quantum_user_collection');
            if (savedCollection) {
                userCollection = JSON.parse(savedCollection);
                
                // Update NFT supplies based on purchases
                userCollection.forEach(item => {
                    if (nftsData[item.id]) {
                        nftsData[item.id].currentSupply--;
                    }
                });
            }
        }
        
        // Save user collection
        function saveUserCollection() {
            localStorage.setItem('quantum_user_collection', JSON.stringify(userCollection));
        }
        
        // Update display
        function updateDisplay() {
            // Update NFT stocks
            document.getElementById('cross-stock').textContent = 
                nftsData.cross.currentSupply.toLocaleString() + ' / ' + nftsData.cross.totalSupply.toLocaleString();
            document.getElementById('cybercar-stock').textContent = 
                nftsData.cybercar.currentSupply.toLocaleString() + ' / ' + nftsData.cybercar.totalSupply.toLocaleString();
            
            // Update collection
            updateCollectionDisplay();
        }
        
        // Update collection display
        function updateCollectionDisplay() {
            const emptyCollection = document.getElementById('empty-collection');
            const collectionGrid = document.getElementById('collection-grid');
            
            if (userCollection.length > 0) {
                emptyCollection.style.display = 'none';
                collectionGrid.style.display = 'grid';
                
                // Clear grid
                collectionGrid.innerHTML = '';
                
                // Add collection items
                userCollection.forEach((item, index) => {
                    const nft = nftsData[item.id];
                    if (!nft) return;
                    
                    const collectionItem = document.createElement('div');
                    collectionItem.className = 'collection-item';
                    collectionItem.onclick = () => showOwnedNFTModal(item);
                    
                    collectionItem.innerHTML = `
                        <div class="collection-icon">
                            <i class="fas fa-${nft.icon}" style="color: ${nft.icon === 'car' ? '#00c6ff' : '#fff'};"></i>
                        </div>
                        <div class="collection-name">${nft.name}</div>
                    `;
                    
                    collectionGrid.appendChild(collectionItem);
                });
            } else {
                emptyCollection.style.display = 'block';
                collectionGrid.style.display = 'none';
            }
        }
        
        // Show NFT modal for purchase
        function showNFTModal(nftId) {
            const nft = nftsData[nftId];
            if (!nft) return;
            
            currentModalNFT = nftId;
            isViewingOwnedNFT = false;
            
            // Set modal content
            document.getElementById('modal-title').textContent = 'Collectible Details';
            document.getElementById('modal-name').textContent = nft.name;
            document.getElementById('modal-price').textContent = nft.price;
            document.getElementById('modal-supply').textContent = 
                nft.currentSupply.toLocaleString() + ' / ' + nft.totalSupply.toLocaleString();
            document.getElementById('modal-upgrade').textContent = 'Not available';
            
            // Set image
            const modalImage = document.getElementById('modal-image');
            modalImage.innerHTML = '';
            if (nft.image) {
                const img = document.createElement('img');
                img.src = nft.image;
                img.alt = nft.name;
                img.onerror = () => {
                    modalImage.innerHTML = `<i class="fas fa-${nft.icon}" style="font-size: 64px; color: ${nft.icon === 'car' ? '#00c6ff' : '#fff'};"></i>`;
                };
                modalImage.appendChild(img);
            } else {
                modalImage.innerHTML = `<i class="fas fa-${nft.icon}" style="font-size: 64px; color: ${nft.icon === 'car' ? '#00c6ff' : '#fff'};"></i>`;
            }
            
            // Show/hide purchase time
            document.getElementById('purchase-time-container').style.display = 'none';
            
            // Show buy button
            const buyBtn = document.getElementById('modal-buy-btn');
            buyBtn.style.display = 'block';
            buyBtn.textContent = `Purchase for ${nft.price}`;
            buyBtn.onclick = () => buyNFT(nftId);
            buyBtn.disabled = nft.currentSupply <= 0;
            
            // Show modal
            document.getElementById('nft-modal').classList.add('active');
        }
        
        // Show owned NFT modal
        function showOwnedNFTModal(item) {
            const nft = nftsData[item.id];
            if (!nft) return;
            
            currentModalNFT = item.id;
            isViewingOwnedNFT = true;
            
            // Set modal content
            document.getElementById('modal-title').textContent = 'Your Collectible';
            document.getElementById('modal-name').textContent = nft.name;
            document.getElementById('modal-price').textContent = 'Owned';
            document.getElementById('modal-supply').textContent = 
                nft.currentSupply.toLocaleString() + ' / ' + nft.totalSupply.toLocaleString();
            document.getElementById('modal-upgrade').textContent = 'Not available';
            
            // Set image
            const modalImage = document.getElementById('modal-image');
            modalImage.innerHTML = '';
            if (nft.image) {
                const img = document.createElement('img');
                img.src = nft.image;
                img.alt = nft.name;
                img.onerror = () => {
                    modalImage.innerHTML = `<i class="fas fa-${nft.icon}" style="font-size: 64px; color: ${nft.icon === 'car' ? '#00c6ff' : '#fff'};"></i>`;
                };
                modalImage.appendChild(img);
            } else {
                modalImage.innerHTML = `<i class="fas fa-${nft.icon}" style="font-size: 64px; color: ${nft.icon === 'car' ? '#00c6ff' : '#fff'};"></i>`;
            }
            
            // Show purchase time
            document.getElementById('purchase-time-container').style.display = 'block';
            document.getElementById('purchase-time').textContent = formatDateTime(new Date(item.purchaseDate));
            
            // Hide buy button
            document.getElementById('modal-buy-btn').style.display = 'none';
            
            // Show modal
            document.getElementById('nft-modal').classList.add('active');
        }
        
        // Close modal
        function closeModal() {
            document.getElementById('nft-modal').classList.remove('active');
            currentModalNFT = null;
            isViewingOwnedNFT = false;
        }
        
        // Buy NFT
        function buyNFT(nftId) {
            const nft = nftsData[nftId];
            
            if (!isConnected) {
                tg.showPopup({
                    title: 'Wallet Not Connected',
                    message: 'Please connect your TON wallet to make purchases.',
                    buttons: [{id: 'ok', type: 'default', text: 'OK'}]
                });
                return;
            }
            
            if (nft.currentSupply <= 0) {
                tg.showPopup({
                    title: 'Out of Stock',
                    message: 'This collectible is no longer available!',
                    buttons: [{id: 'ok', type: 'default', text: 'OK'}]
                });
                return;
            }
            
            // In a real app, this would open TON Connect payment modal
            // For demo, we'll simulate payment
            tg.showPopup({
                title: 'Confirm Purchase',
                message: `Purchase ${nft.name} for ${nft.price}?`,
                buttons: [
                    {id: 'cancel', type: 'cancel', text: 'Cancel'},
                    {id: 'buy', type: 'default', text: 'Confirm Purchase'}
                ]
            }, (buttonId) => {
                if (buttonId === 'buy') {
                    processPurchase(nftId);
                }
            });
        }
        
        // Process purchase
        function processPurchase(nftId) {
            const nft = nftsData[nftId];
            
            // Decrease supply
            nft.currentSupply--;
            
            // Add to user collection
            const purchaseItem = {
                id: nftId,
                purchaseDate: new Date().toISOString(),
                transactionId: generateTransactionId()
            };
            
            userCollection.push(purchaseItem);
            
            // Save data
            saveUserCollection();
            
            // Update display
            updateDisplay();
            
            // Close modal
            closeModal();
            
            // Show success message
            tg.showPopup({
                title: 'Purchase Complete!',
                message: `You successfully acquired ${nft.name}! This digital collectible has been added to your collection.`,
                buttons: [{id: 'ok', type: 'default', text: 'View Collection'}]
            }, () => {
                showPage('profile-page');
            });
            
            // In a real app, you would send transaction to blockchain here
            sendTONTransaction(nftId, userData.id, nft.price);
        }
        
        // Send TON transaction (for real implementation)
        function sendTONTransaction(nftId, userId, amount) {
            // This would send the actual TON transaction to the blockchain
            console.log(`Sending ${amount} TON for ${nftId} from user ${userId}`);
            
            // In a real implementation, you would use:
            // tonConnectUI.sendTransaction(transaction)
        }
        
        // Generate transaction ID
        function generateTransactionId() {
            return 'ton_tx_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        // Switch between pages
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Update active nav button
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            if (pageId === 'store-page') {
                document.querySelectorAll('.nav-item')[0].classList.add('active');
            } else if (pageId === 'profile-page') {
                document.querySelectorAll('.nav-item')[1].classList.add('active');
            }
        }
        
        // Format date
        function formatDate(date) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }
        
        // Format date and time
        function formatDateTime(date) {
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return date.toLocaleDateString('en-US', options);
        }
    </script>
</body>
</html>
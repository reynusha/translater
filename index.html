<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum | TON NFT Marketplace</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --tg-theme-bg-color: #0a0a0a;
            --tg-theme-text-color: #ffffff;
            --tg-theme-hint-color: #888888;
            --tg-theme-link-color: #0088cc;
            --tg-theme-button-color: #0088cc;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-secondary-bg-color: #1a1a1a;
            --border-color: #2a2a2a;
            --accent-color: #0088cc;
            --ton-color: #0088cc;
            --success-color: #00d26a;
            --card-bg: #151515;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }
        
        body {
            background-color: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            min-height: 100vh;
            padding-bottom: 80px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 0 16px;
        }
        
        .header {
            text-align: center;
            padding: 24px 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 24px;
            position: relative;
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: 1px;
            background: linear-gradient(135deg, #0088cc, #00c6ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header p {
            color: var(--tg-theme-hint-color);
            margin-top: 8px;
            font-size: 14px;
        }
        
        .section {
            margin-bottom: 32px;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: var(--accent-color);
        }
        
        .gift-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        .gift-card {
            background: var(--card-bg);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .gift-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-color);
            box-shadow: 0 10px 20px rgba(0, 136, 204, 0.15);
        }
        
        .gift-image {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }
        
        .gift-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .gift-card:hover .gift-image img {
            transform: scale(1.05);
        }
        
        .gift-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }
        
        .gift-info {
            padding: 16px;
        }
        
        .gift-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .gift-price {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .gift-stock {
            font-size: 12px;
            color: var(--tg-theme-hint-color);
        }
        
        .price {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
            color: var(--ton-color);
        }
        
        .price i {
            font-size: 16px;
        }
        
        .buy-button {
            width: 100%;
            padding: 12px 0;
            background: linear-gradient(135deg, var(--ton-color), #0066aa);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .buy-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 136, 204, 0.3);
        }
        
        .buy-button:disabled {
            background: var(--border-color);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .profile-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
            text-align: center;
        }
        
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 16px;
            border: 2px solid var(--accent-color);
            overflow: hidden;
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .profile-avatar i {
            font-size: 32px;
            color: var(--accent-color);
        }
        
        .profile-name {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 6px;
        }
        
        .profile-joined {
            font-size: 14px;
            color: var(--tg-theme-hint-color);
            margin-bottom: 16px;
        }
        
        .wallet-info {
            background: rgba(0, 136, 204, 0.1);
            border-radius: 10px;
            padding: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 12px;
        }
        
        .wallet-info i {
            color: var(--ton-color);
        }
        
        .owned-gifts {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }
        
        .owned-gift {
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            text-align: center;
            transition: transform 0.2s ease;
        }
        
        .owned-gift:hover {
            transform: scale(1.05);
        }
        
        .owned-gift-image {
            width: 100%;
            height: 80px;
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .owned-gift-image i {
            font-size: 24px;
            color: var(--accent-color);
        }
        
        .owned-gift-name {
            font-size: 11px;
            padding: 8px 4px;
            font-weight: 500;
        }
        
        .info-box {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            margin-top: 24px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }
        
        .info-box:before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--ton-color), #00c6ff);
        }
        
        .info-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-text {
            font-size: 14px;
            color: var(--tg-theme-hint-color);
            line-height: 1.5;
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--tg-theme-bg-color);
            border-top: 1px solid var(--border-color);
            display: flex;
            padding: 12px 0;
            backdrop-filter: blur(10px);
            z-index: 1000;
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            cursor: pointer;
            transition: color 0.2s ease;
            padding: 8px 0;
        }
        
        .nav-item.active {
            color: var(--accent-color);
        }
        
        .nav-icon {
            font-size: 20px;
        }
        
        .nav-label {
            font-size: 12px;
            font-weight: 500;
        }
        
        .page {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .page.active {
            display: block;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--tg-theme-hint-color);
        }
        
        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: var(--accent-color);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .payment-processing {
            text-align: center;
            padding: 40px 20px;
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status-badge.connected {
            background: rgba(0, 210, 106, 0.2);
            color: var(--success-color);
        }
        
        .status-badge.disconnected {
            background: rgba(255, 59, 48, 0.2);
            color: #ff3b30;
        }
        
        .ton-payment-info {
            background: rgba(0, 136, 204, 0.1);
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
            font-size: 13px;
            border-left: 3px solid var(--ton-color);
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>QUANTUM</h1>
            <p>Premium NFT Marketplace on TON</p>
        </div>
        
        <!-- Store Page -->
        <div id="store-page" class="page active">
            <div class="section">
                <h2 class="section-title">
                    <i class="fas fa-gem"></i>
                    Exclusive Collection
                </h2>
                
                <div class="gift-grid">
                    <!-- Christian Cross -->
                    <div class="gift-card">
                        <div class="gift-image">
                            <i class="fas fa-cross" style="font-size: 48px; color: #fff;"></i>
                            <div class="gift-badge">LIMITED</div>
                        </div>
                        <div class="gift-info">
                            <div class="gift-name">Christian Cross</div>
                            <div class="gift-price">
                                <div class="price">
                                    <i class="fab fa-toncoin"></i>
                                    <span>0.5</span>
                                </div>
                                <div class="gift-stock" id="cross-stock">1,200 available</div>
                            </div>
                            <button class="buy-button" onclick="initiateTONPurchase('cross')" id="buy-cross">
                                <i class="fab fa-toncoin"></i>
                                Buy for 0.5 TON
                            </button>
                        </div>
                    </div>
                    
                    <!-- Cybercar -->
                    <div class="gift-card">
                        <div class="gift-image">
                            <i class="fas fa-car" style="font-size: 48px; color: #00c6ff;"></i>
                            <div class="gift-badge">NEW</div>
                        </div>
                        <div class="gift-info">
                            <div class="gift-name">Cybercar</div>
                            <div class="gift-price">
                                <div class="price">
                                    <i class="fab fa-toncoin"></i>
                                    <span>0.5</span>
                                </div>
                                <div class="gift-stock" id="cybercar-stock">2,000 available</div>
                            </div>
                            <button class="buy-button" onclick="initiateTONPurchase('cybercar')" id="buy-cybercar">
                                <i class="fab fa-toncoin"></i>
                                Buy for 0.5 TON
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="info-box">
                <div class="info-title">
                    <i class="fas fa-rocket"></i>
                    Future Evolution
                </div>
                <div class="info-text">
                    Your collectibles will soon be upgradable to exclusive NFTs with unique traits and rarity scores. These digital assets will be tradeable on our upcoming marketplace, creating new opportunities for collectors and investors in the TON ecosystem.
                </div>
                <div class="ton-payment-info">
                    <i class="fas fa-info-circle"></i>
                    All payments are processed securely on the TON blockchain. Each purchase is a verified on-chain transaction.
                </div>
            </div>
        </div>
        
        <!-- Profile Page -->
        <div id="profile-page" class="page">
            <div class="section">
                <div class="profile-card">
                    <div class="profile-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="profile-name" id="user-name">User</div>
                    <div class="profile-joined" id="user-joined">Member since: Loading...</div>
                    
                    <div class="wallet-info">
                        <i class="fas fa-wallet"></i>
                        <span>TON Wallet: </span>
                        <span id="wallet-status" class="status-badge disconnected">Not Connected</span>
                    </div>
                </div>
                
                <h2 class="section-title">
                    <i class="fas fa-crown"></i>
                    My Collection
                </h2>
                
                <div id="owned-gifts-container">
                    <div class="empty-state" id="no-gifts-message">
                        <i class="fas fa-box-open"></i>
                        <p>Your collection is empty</p>
                        <p style="font-size: 13px; margin-top: 8px;">Start building your NFT collection</p>
                    </div>
                    <div class="owned-gifts" id="owned-gifts-list" style="display: none;">
                        <!-- Owned gifts will appear here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Payment Processing -->
        <div id="payment-processing" class="page">
            <div class="payment-processing">
                <div class="loading" style="margin-bottom: 20px;"></div>
                <h3>Processing TON Payment</h3>
                <p style="margin-top: 10px; color: var(--tg-theme-hint-color);">Confirm the transaction in your wallet...</p>
                <div class="ton-payment-info" style="margin-top: 20px;">
                    <i class="fas fa-shield-alt"></i>
                    Secure blockchain transaction
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="showPage('store-page')">
            <div class="nav-icon">
                <i class="fas fa-store"></i>
            </div>
            <div class="nav-label">Store</div>
        </div>
        <div class="nav-item" onclick="showPage('profile-page')">
            <div class="nav-icon">
                <i class="fas fa-user"></i>
            </div>
            <div class="nav-label">Profile</div>
        </div>
    </div>

    <script>
        // Telegram WebApp
        const tg = window.Telegram.WebApp;
        
        // Initialize
        tg.expand();
        tg.enableClosingConfirmation();
        
        // TON Configuration
        const TON_CONFIG = {
            merchantAddress: 'UQBYt_yorGejtv403290WeEgd1hJiCB2vx_7obx3cFjDlYEF',
            network: 'ton-mainnet',
            prices: {
                cross: 0.5,
                cybercar: 0.5
            }
        };
        
        // User data
        let userData = {
            id: tg.initDataUnsafe.user?.id || 'unknown',
            firstName: tg.initDataUnsafe.user?.first_name || 'User',
            lastName: tg.initDataUnsafe.user?.last_name || '',
            username: tg.initDataUnsafe.user?.username || '',
            photoUrl: tg.initDataUnsafe.user?.photo_url || '',
            joinDate: null
        };
        
        // Gifts data
        let giftsData = {
            cross: {
                name: 'Christian Cross',
                price: 0.5,
                stock: 1200,
                icon: 'cross',
                productId: 'christian_cross_001'
            },
            cybercar: {
                name: 'Cybercar',
                price: 0.5,
                stock: 2000,
                icon: 'car',
                productId: 'cybercar_001'
            }
        };
        
        // User's purchased gifts
        let userGifts = [];
        let tonWalletConnected = false;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // Load user data
            loadUserData();
            
            // Load purchased gifts
            loadUserGifts();
            
            // Update display
            updateGiftDisplay();
            
            // Initialize TON wallet
            initTONWallet();
        }
        
        // Load user data
        function loadUserData() {
            // Set user name
            const nameElement = document.getElementById('user-name');
            nameElement.textContent = userData.firstName + (userData.lastName ? ' ' + userData.lastName : '');
            
            // Set join date
            const joinElement = document.getElementById('user-joined');
            const joinDate = localStorage.getItem('quantum_join_date');
            if (joinDate) {
                userData.joinDate = new Date(joinDate);
                joinElement.textContent = 'Member since: ' + formatDate(userData.joinDate);
            } else {
                const now = new Date();
                localStorage.setItem('quantum_join_date', now.toISOString());
                userData.joinDate = now;
                joinElement.textContent = 'Member since: ' + formatDate(now);
            }
        }
        
        // Initialize TON Wallet
        function initTONWallet() {
            // Check if TON wallet is available
            if (window.ton && ton.isTonWallet) {
                connectTONWallet();
            } else {
                // For demo purposes, simulate wallet connection
                setTimeout(() => {
                    tonWalletConnected = true;
                    updateWalletStatus();
                }, 1000);
            }
        }
        
        // Connect TON Wallet
        async function connectTONWallet() {
            try {
                if (window.ton) {
                    await ton.request({ method: 'ton_requestAccounts' });
                    tonWalletConnected = true;
                    updateWalletStatus();
                    
                    tg.showPopup({
                        title: 'TON Wallet Connected',
                        message: 'Your TON wallet is now connected and ready for transactions.',
                        buttons: [{id: 'ok', type: 'default', text: 'OK'}]
                    });
                }
            } catch (error) {
                console.error('TON Wallet connection failed:', error);
                tg.showPopup({
                    title: 'Connection Failed',
                    message: 'Unable to connect TON wallet. Please try again.',
                    buttons: [{id: 'ok', type: 'default', text: 'OK'}]
                });
            }
        }
        
        // Update wallet status display
        function updateWalletStatus() {
            const statusElement = document.getElementById('wallet-status');
            if (tonWalletConnected) {
                statusElement.textContent = 'Connected';
                statusElement.className = 'status-badge connected';
            } else {
                statusElement.textContent = 'Not Connected';
                statusElement.className = 'status-badge disconnected';
            }
        }
        
        // Load user gifts
        function loadUserGifts() {
            const savedGifts = localStorage.getItem('quantum_user_gifts');
            if (savedGifts) {
                userGifts = JSON.parse(savedGifts);
            }
        }
        
        // Save user gifts
        function saveUserGifts() {
            localStorage.setItem('quantum_user_gifts', JSON.stringify(userGifts));
        }
        
        // Update gift display
        function updateGiftDisplay() {
            // Update stock in store
            document.getElementById('cross-stock').textContent = giftsData.cross.stock.toLocaleString() + ' available';
            document.getElementById('cybercar-stock').textContent = giftsData.cybercar.stock.toLocaleString() + ' available';
            
            // Update owned gifts in profile
            const ownedGiftsList = document.getElementById('owned-gifts-list');
            const noGiftsMessage = document.getElementById('no-gifts-message');
            
            if (userGifts.length > 0) {
                noGiftsMessage.style.display = 'none';
                ownedGiftsList.style.display = 'grid';
                
                // Clear list
                ownedGiftsList.innerHTML = '';
                
                // Add owned gifts
                userGifts.forEach(gift => {
                    const giftElement = document.createElement('div');
                    giftElement.className = 'owned-gift';
                    
                    giftElement.innerHTML = `
                        <div class="owned-gift-image">
                            <i class="fas fa-${gift.icon}" style="font-size: 24px; color: ${gift.icon === 'car' ? '#00c6ff' : '#fff'};"></i>
                        </div>
                        <div class="owned-gift-name">${gift.name}</div>
                    `;
                    
                    ownedGiftsList.appendChild(giftElement);
                });
            } else {
                noGiftsMessage.style.display = 'block';
                ownedGiftsList.style.display = 'none';
            }
        }
        
        // Initiate TON purchase
        function initiateTONPurchase(giftId) {
            const gift = giftsData[giftId];
            
            if (gift.stock <= 0) {
                tg.showPopup({
                    title: 'Out of Stock',
                    message: 'This collectible is no longer available!',
                    buttons: [{id: 'ok', type: 'default', text: 'OK'}]
                });
                return;
            }
            
            if (!tonWalletConnected) {
                tg.showPopup({
                    title: 'Wallet Not Connected',
                    message: 'Please connect your TON wallet to make purchases.',
                    buttons: [
                        {id: 'cancel', type: 'cancel', text: 'Cancel'},
                        {id: 'connect', type: 'default', text: 'Connect Wallet'}
                    ]
                }, (buttonId) => {
                    if (buttonId === 'connect') {
                        connectTONWallet();
                    }
                });
                return;
            }
            
            // Show payment processing
            showPage('payment-processing');
            
            // Simulate TON payment processing
            setTimeout(() => {
                completeTONPurchase(giftId);
            }, 3000);
        }
        
        // Complete TON purchase
        function completeTONPurchase(giftId) {
            const gift = giftsData[giftId];
            
            // Decrease stock
            gift.stock--;
            
            // Add gift to user's collection
            userGifts.push({
                id: giftId,
                name: gift.name,
                icon: gift.icon,
                purchaseDate: new Date().toISOString(),
                transactionId: generateTransactionId()
            });
            
            // Save data
            saveUserGifts();
            
            // Update display
            updateGiftDisplay();
            
            // Return to store
            showPage('store-page');
            
            // Show success message
            tg.showPopup({
                title: 'Purchase Complete!',
                message: `You successfully acquired ${gift.name}! This collectible has been added to your collection.`,
                buttons: [{id: 'ok', type: 'default', text: 'View Collection'}]
            }, () => {
                showPage('profile-page');
            });
            
            // In a real app, you would send transaction data to your backend
            sendTONTransactionToServer(giftId, userData.id);
        }
        
        // Send transaction data to server (for real implementation)
        async function sendTONTransactionToServer(giftId, userId) {
            // This would send the transaction details to your backend
            // for verification and recording on the blockchain
            try {
                const response = await fetch('/api/ton-purchase', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        giftId: giftId,
                        userId: userId,
                        merchantAddress: TON_CONFIG.merchantAddress,
                        amount: giftsData[giftId].price,
                        timestamp: new Date().toISOString()
                    })
                });
                
                if (response.ok) {
                    console.log('TON transaction recorded on server');
                }
            } catch (error) {
                console.error('Error recording TON transaction:', error);
            }
        }
        
        // Generate transaction ID
        function generateTransactionId() {
            return 'ton_tx_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        // Switch between pages
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Update active nav button
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            if (pageId === 'store-page') {
                document.querySelectorAll('.nav-item')[0].classList.add('active');
            } else if (pageId === 'profile-page') {
                document.querySelectorAll('.nav-item')[1].classList.add('active');
            }
        }
        
        // Format date
        function formatDate(date) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }
    </script>
</body>
</html>
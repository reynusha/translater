<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collectible Gifts</title>
    <style>
        :root {
            --bg-primary: #1e1e1e;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #3a3a3a;
            --text-primary: #ffffff;
            --text-secondary: #aaaaaa;
            --accent: #3390ec;
            --border: #444444;
            --gradient-start: #3390ec;
            --gradient-end: #8247e5;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 16px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 16px;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
        }

        .nav-tabs {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .nav-tab {
            padding: 12px 0;
            flex: 1;
            text-align: center;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.2s;
            border-bottom: 2px solid transparent;
        }

        .nav-tab.active {
            color: var(--text-primary);
            border-bottom: 2px solid var(--accent);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .gift-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid var(--border);
        }

        .gift-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 12px;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
        }

        .gift-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .gift-details {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 12px;
        }

        .gift-price {
            display: flex;
            align-items: center;
            font-weight: 600;
            color: #ffd700;
        }

        .buy-button {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 16px;
            width: 100%;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .buy-button:hover {
            opacity: 0.9;
        }

        .buy-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .avatar {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            margin-right: 16px;
        }

        .profile-info h2 {
            font-size: 18px;
            margin-bottom: 4px;
        }

        .profile-info p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .owned-gifts {
            margin-top: 20px;
        }

        .owned-gifts h3 {
            margin-bottom: 12px;
            font-size: 16px;
        }

        .gift-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .owned-gift-card {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .owned-gift-image {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 6px;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
        }

        .owned-gift-name {
            font-size: 14px;
            margin-bottom: 4px;
        }

        .owned-gift-count {
            color: var(--text-secondary);
            font-size: 12px;
        }

        .marketplace-message {
            text-align: center;
            padding: 40px 20px;
        }

        .marketplace-message h2 {
            font-size: 24px;
            margin-bottom: 16px;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .marketplace-message p {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .section-title {
            font-size: 18px;
            margin-bottom: 16px;
            font-weight: 600;
        }

        .sold-out-badge {
            background: #ff4757;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Collectible Gifts</h1>
        </div>

        <div class="nav-tabs">
            <div class="nav-tab active" data-tab="home">Home</div>
            <div class="nav-tab" data-tab="profile">Profile</div>
            <div class="nav-tab" data-tab="market">Market</div>
        </div>

        <!-- Home Section -->
        <div class="section active" id="home">
            <div class="section-title">Available Gifts</div>
            
            <div class="gift-card" id="sculpture">
                <img src="https://i.postimg.cc/jjKZKCz1/IMG-20250902-072312-313.jpg" alt="Sculpture" class="gift-image">
                <div class="gift-name">Sculpture</div>
                <div class="gift-details">
                    <span>Available: <span id="sculpture-available">550</span>/550</span>
                    <span class="gift-price">50 82</span>
                </div>
                <button class="buy-button" data-gift="sculpture" data-price="50">Buy Now</button>
            </div>

            <div class="gift-card" id="crystal-lion">
                <img src="https://i.postimg.cc/ZK1hPkNx/kmc-20251004-221530.png" alt="Crystal Lion" class="gift-image">
                <div class="gift-name">Crystal Lion</div>
                <div class="gift-details">
                    <span>Available: <span id="crystal-lion-available">1000</span>/1000</span>
                    <span class="gift-price">25 82</span>
                </div>
                <button class="buy-button" data-gift="crystal-lion" data-price="25">Buy Now</button>
            </div>

            <div class="gift-card" id="dollar">
                <div class="gift-image" style="background: linear-gradient(135deg, #27ae60, #2ecc71);"></div>
                <div class="gift-name">Dollar</div>
                <div class="gift-details">
                    <span>Available: <span id="dollar-available">3000</span>/3000</span>
                    <span class="gift-price">5 82</span>
                </div>
                <button class="buy-button" data-gift="dollar" data-price="5">Buy Now</button>
            </div>

            <div class="section-title" id="sold-out-title" style="display: none;">Sold Out</div>
            <div id="sold-out-container"></div>
        </div>

        <!-- Profile Section -->
        <div class="section" id="profile">
            <div class="profile-header">
                <div class="avatar"></div>
                <div class="profile-info">
                    <h2 id="username">@username</h2>
                    <p id="member-since">Member since: Loading...</p>
                </div>
            </div>

            <div class="owned-gifts">
                <h3>Your Gifts</h3>
                <div class="gift-grid" id="owned-gifts-grid">
                    <!-- Owned gifts will be displayed here -->
                </div>
            </div>
        </div>

        <!-- Market Section -->
        <div class="section" id="market">
            <div class="marketplace-message">
                <h2>Dreams Come True</h2>
                <p>Very soon, our marketplace will be launched where you can trade your collectible gifts. Buy and sell them freely. From that point, gift prices will be determined exclusively by the community.</p>
            </div>
        </div>
    </div>

    <script>
        // Initialize Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // User data
        let userData = {
            username: tg.initDataUnsafe?.user?.username || 'user',
            memberSince: new Date(),
            ownedGifts: {
                sculpture: 0,
                crystalLion: 0,
                dollar: 0
            }
        };

        // Gift data
        const gifts = {
            sculpture: {
                name: 'Sculpture',
                total: 550,
                available: 550,
                price: 50,
                image: 'https://i.postimg.cc/jjKZKCz1/IMG-20250902-072312-313.jpg'
            },
            crystalLion: {
                name: 'Crystal Lion',
                total: 1000,
                available: 1000,
                price: 25,
                image: 'https://i.postimg.cc/ZK1hPkNx/kmc-20251004-221530.png'
            },
            dollar: {
                name: 'Dollar',
                total: 3000,
                available: 3000,
                price: 5,
                image: null
            }
        };

        // DOM elements
        const navTabs = document.querySelectorAll('.nav-tab');
        const sections = document.querySelectorAll('.section');
        const buyButtons = document.querySelectorAll('.buy-button');
        const usernameElement = document.getElementById('username');
        const memberSinceElement = document.getElementById('member-since');
        const ownedGiftsGrid = document.getElementById('owned-gifts-grid');
        const soldOutContainer = document.getElementById('sold-out-container');
        const soldOutTitle = document.getElementById('sold-out-title');

        // Load user data from localStorage
        function loadUserData() {
            const savedData = localStorage.getItem('collectibleGiftsUserData');
            if (savedData) {
                userData = JSON.parse(savedData);
                userData.memberSince = new Date(userData.memberSince);
            }
            
            // Update UI with user data
            usernameElement.textContent = '@' + userData.username;
            const daysSince = Math.floor((new Date() - userData.memberSince) / (1000 * 60 * 60 * 24));
            memberSinceElement.textContent = `Member for ${daysSince} days`;
            
            updateOwnedGiftsDisplay();
        }

        // Save user data to localStorage
        function saveUserData() {
            localStorage.setItem('collectibleGiftsUserData', JSON.stringify(userData));
        }

        // Update the display of owned gifts
        function updateOwnedGiftsDisplay() {
            ownedGiftsGrid.innerHTML = '';
            
            for (const [giftId, count] of Object.entries(userData.ownedGifts)) {
                if (count > 0) {
                    const gift = gifts[giftId];
                    const giftCard = document.createElement('div');
                    giftCard.className = 'owned-gift-card';
                    
                    if (gift.image) {
                        giftCard.innerHTML = `
                            <img src="${gift.image}" alt="${gift.name}" class="owned-gift-image">
                            <div class="owned-gift-name">${gift.name}</div>
                            <div class="owned-gift-count">Owned: ${count}</div>
                        `;
                    } else {
                        giftCard.innerHTML = `
                            <div class="owned-gift-image" style="background: linear-gradient(135deg, #27ae60, #2ecc71);"></div>
                            <div class="owned-gift-name">${gift.name}</div>
                            <div class="owned-gift-count">Owned: ${count}</div>
                        `;
                    }
                    
                    ownedGiftsGrid.appendChild(giftCard);
                }
            }
            
            if (ownedGiftsGrid.children.length === 0) {
                ownedGiftsGrid.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; color: var(--text-secondary);">You don\'t own any gifts yet</p>';
            }
        }

        // Handle gift purchase
        function handlePurchase(giftId) {
            const gift = gifts[giftId];
            
            if (gift.available <= 0) {
                tg.showPopup({
                    title: 'Out of Stock',
                    message: `Sorry, ${gift.name} is sold out.`,
                    buttons: [{ type: 'ok' }]
                });
                return;
            }
            
            // In a real implementation, this would use Telegram's official Stars payment
            tg.showPopup({
                title: 'Confirm Purchase',
                message: `Do you want to buy ${gift.name} for ${gift.price} Stars?`,
                buttons: [
                    { type: 'cancel' },
                    { 
                        type: 'default', 
                        text: 'Buy', 
                        id: 'buy'
                    }
                ]
            });
            
            tg.onEvent('popupClosed', (event) => {
                if (event.button_id === 'buy') {
                    // Simulate successful purchase
                    gift.available--;
                    userData.ownedGifts[giftId]++;
                    
                    // Update UI
                    document.getElementById(`${giftId}-available`).textContent = gift.available;
                    
                    // Check if gift is sold out
                    if (gift.available === 0) {
                        const giftCard = document.getElementById(giftId);
                        const buyButton = giftCard.querySelector('.buy-button');
                        buyButton.disabled = true;
                        buyButton.textContent = 'Sold Out';
                        
                        // Move to sold out section
                        soldOutTitle.style.display = 'block';
                        giftCard.querySelector('.gift-details').innerHTML = `<span class="sold-out-badge">SOLD OUT</span>`;
                        soldOutContainer.appendChild(giftCard);
                    }
                    
                    updateOwnedGiftsDisplay();
                    saveUserData();
                    
                    tg.showPopup({
                        title: 'Purchase Successful',
                        message: `You've successfully purchased ${gift.name}!`,
                        buttons: [{ type: 'ok' }]
                    });
                }
                
                // Remove the event listener to prevent multiple bindings
                tg.offEvent('popupClosed', arguments.callee);
            });
        }

        // Initialize the app
        function initApp() {
            // Set up navigation
            navTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    
                    navTabs.forEach(t => t.classList.remove('active'));
                    sections.forEach(s => s.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // Set up buy buttons
            buyButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const giftId = button.getAttribute('data-gift');
                    handlePurchase(giftId);
                });
            });
            
            // Load user data
            loadUserData();
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>